#!/usr/bin/env bash
#  unmount disk
set -ex

lsblk -Pbo name,type,size,mountpoint,fstype,label | while read -r a; do
	eval "$a"

	[ "$MOUNTPOINT" ] && ! grep -iq "\s$MOUNTPOINT\s" /etc/fstab &&
		printf "%-4s - %s %s %s  [%s]\n" \
			"$NAME" \
			"$(numfmt --to=iec "$SIZE")" \
			"$FSTYPE," \
			"${LABEL:-null}" \
			"${MOUNTPOINT//$HOME/\~}"

done | menu -p unmount | {
	read -r disk _ _ _ _ mp; mp=${mp//[\[\]]} mp=${mp//\~/$HOME} mp=/${mp#*/}
	sudo umount "$mp"
	notify-send "unmounted $disk" "[$mp]"
	sudo rmdir "$HOME/mnt/$disk"
}
