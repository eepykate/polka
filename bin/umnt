#!/usr/bin/env bash
#  unmount disk
set -e

lsblk -Po NAME,SIZE,MOUNTPOINT,FSTYPE,LABEL | while read -r a; do
	eval "$a"

	[ "$MOUNTPOINT" ] && ! grep -iq "\s$MOUNTPOINT\s" /etc/fstab &&
		printf "%-4s - %s %s %s  [%s]\n" \
			"$NAME" \
			"$SIZE" \
			"$FSTYPE," \
			"${LABEL:-unnamed}" \
			"${MOUNTPOINT//$HOME/\~}"

done | menu -p unmount | {
	read -r disk _
	eval "$(lsblk -Po LABEL,MOUNTPOINT "/dev/$disk")"
	sudo umount "$MOUNTPOINT"
	notify-send "unmounted $disk ($LABEL)"  "[$MOUNTPOINT]"
	sudo rmdir "$HOME/dev/$disk" ||:
}
